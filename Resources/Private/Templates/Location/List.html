{namespace map=Tx_EasyGooglemap_ViewHelpers}
<f:layout name="Default" />

<f:debug>{all}</f:debug>

<f:section name="main">
	<f:flashMessages />

	<div id="karte" class="" style="height: 380px; width: auto"></div>

	<script>
		<![CDATA[
	    var MapStyle = [ { stylers: [ { saturation: -98 }, { gamma: 0.79 } ] } ];
	    var startcenter = new google.maps.LatLng(47.52190,15.41676);
	    var bounds = new google.maps.LatLngBounds();
	    var data = [
			]]><f:for each="{locations}" as="location"><![CDATA[
			{
	            'title' : ']]>{location.title}<![CDATA[',
	            'position' : new google.maps.LatLng(]]>{location.latitude}<![CDATA[,]]>{location.longitude}<![CDATA[),
	            'clickable' : true,
	            ]]><f:if condition="{location.icon}"><![CDATA[
	            'icon' : "]]>uploads/tx_easygooglemap/{location.icon}<![CDATA[",
	            ]]></f:if><![CDATA[
	            'link' : "]]><map:typolink parameter="{location.link}"/><![CDATA["
			},
	        ]]></f:for><![CDATA[
	    ];
	
	    var optionen = {
	        zoom: 10,
	        center: startcenter,
	        mapTypeId: google.maps.MapTypeId.ROADMAP,
	        styles: MapStyle
	    };
	
	    var map = new google.maps.Map(document.getElementById("karte"), optionen);
	    var markers = [];
	
	    for (var i=0;i<data.length;i++){
	        markers[i] = new google.maps.Marker({
	            position: data[i].position,
	            map: map,
	            clickable: data[i].clickable,
	            url: data[i].link,
	            icon: data[i].icon
	        });
	
	       infobox = new InfoBox({
	             content: data[i].title,
	             disableAutoPan: false,
	             pixelOffset: new google.maps.Size(0, 0),
	             infoBoxClearance: new google.maps.Size(1, 1),
	            closeBoxMargin: "-10px -60px 10px 10px"
	        }).open(map, markers[i]);
	
	        new google.maps.event.addListener(markers[i], 'click', function() {
	            window.open(this.url);
	        });
	        bounds.extend(data[i].position);
	    }
	
	    map.fitBounds(bounds);
		]]>
	</script>
</f:section>